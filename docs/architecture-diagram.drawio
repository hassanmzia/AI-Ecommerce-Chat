<mxfile host="app.diagrams.net" modified="2026-02-05T06:00:00.000Z" agent="draw.io" version="24.0.0" type="device">
  <diagram name="Technical Architecture" id="architecture-main">
    <mxGraphModel dx="2074" dy="1156" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="1200" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- Title -->
        <mxCell id="title" value="AI E-Commerce Chat System — Technical Architecture" style="text;html=1;fontSize=22;fontStyle=1;align=center;verticalAlign=middle;whiteSpace=wrap;fillColor=none;strokeColor=none;fontColor=#1a1a2e;" vertex="1" parent="1">
          <mxGeometry x="350" y="20" width="900" height="40" as="geometry" />
        </mxCell>

        <!-- ===== CLIENT TIER ===== -->
        <mxCell id="client-group" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8f4f8;strokeColor=#5b9bd5;strokeWidth=2;dashed=1;arcSize=8;" vertex="1" parent="1">
          <mxGeometry x="40" y="80" width="320" height="320" as="geometry" />
        </mxCell>
        <mxCell id="client-label" value="CLIENT TIER" style="text;html=1;fontSize=13;fontStyle=1;align=center;fillColor=none;strokeColor=none;fontColor=#2e75b6;" vertex="1" parent="1">
          <mxGeometry x="140" y="85" width="120" height="20" as="geometry" />
        </mxCell>

        <mxCell id="frontend" value="&lt;b&gt;Frontend&lt;/b&gt;&lt;br&gt;React 18 + TypeScript&lt;br&gt;Vite + TailwindCSS&lt;br&gt;Nginx (port 3065)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;verticalAlign=middle;arcSize=12;" vertex="1" parent="1">
          <mxGeometry x="80" y="115" width="240" height="70" as="geometry" />
        </mxCell>
        <mxCell id="fe-chat" value="Chat UI" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#999;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="80" y="200" width="75" height="35" as="geometry" />
        </mxCell>
        <mxCell id="fe-auth" value="Auth Pages" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#999;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="163" y="200" width="75" height="35" as="geometry" />
        </mxCell>
        <mxCell id="fe-dash" value="Dashboard" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#999;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="245" y="200" width="75" height="35" as="geometry" />
        </mxCell>
        <mxCell id="fe-libs" value="React Query  |  Zustand  |  Framer Motion  |  Recharts" style="text;html=1;fontSize=9;align=center;fillColor=none;strokeColor=none;fontColor=#666;" vertex="1" parent="1">
          <mxGeometry x="80" y="245" width="240" height="20" as="geometry" />
        </mxCell>

        <mxCell id="browser" value="&lt;b&gt;Browser&lt;/b&gt;" style="shape=image;verticalLabelPosition=bottom;labelBackgroundColor=default;verticalAlign=top;aspect=fixed;imageAspect=0;image=data:image/svg+xml,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM1NTUiIHN0cm9rZS13aWR0aD0iMiI+PHJlY3QgeD0iMiIgeT0iMyIgd2lkdGg9IjIwIiBoZWlnaHQ9IjE0IiByeD0iMiIvPjxsaW5lIHgxPSI4IiB5MT0iMjEiIHgyPSIxNiIgeTI9IjIxIi8+PGxpbmUgeDE9IjEyIiB5MT0iMTciIHgyPSIxMiIgeTI9IjIxIi8+PC9zdmc+;fontSize=11;fillColor=none;strokeColor=none;" vertex="1" parent="1">
          <mxGeometry x="80" y="280" width="40" height="40" as="geometry" />
        </mxCell>
        <mxCell id="ws-client" value="WebSocket&lt;br&gt;Client" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="80" y="340" width="90" height="40" as="geometry" />
        </mxCell>
        <mxCell id="rest-client" value="REST / Axios&lt;br&gt;Client" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="210" y="340" width="90" height="40" as="geometry" />
        </mxCell>

        <!-- ===== API TIER ===== -->
        <mxCell id="api-group" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e2f0d9;strokeColor=#70ad47;strokeWidth=2;dashed=1;arcSize=8;" vertex="1" parent="1">
          <mxGeometry x="420" y="80" width="340" height="520" as="geometry" />
        </mxCell>
        <mxCell id="api-label" value="API TIER" style="text;html=1;fontSize=13;fontStyle=1;align=center;fillColor=none;strokeColor=none;fontColor=#548235;" vertex="1" parent="1">
          <mxGeometry x="540" y="85" width="100" height="20" as="geometry" />
        </mxCell>

        <mxCell id="api-service" value="&lt;b&gt;API Service&lt;/b&gt;&lt;br&gt;Node.js 20 + Express&lt;br&gt;Port 3066" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#c6efce;strokeColor=#70ad47;fontSize=11;verticalAlign=middle;arcSize=12;" vertex="1" parent="1">
          <mxGeometry x="460" y="115" width="260" height="55" as="geometry" />
        </mxCell>

        <mxCell id="api-mw" value="&lt;b&gt;Middleware&lt;/b&gt;&lt;br&gt;Helmet | CORS | Morgan&lt;br&gt;Rate Limiter | JWT Auth" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#999;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="460" y="185" width="260" height="50" as="geometry" />
        </mxCell>

        <mxCell id="api-routes" value="&lt;b&gt;REST Routes&lt;/b&gt;" style="text;html=1;fontSize=11;fontStyle=1;align=center;fillColor=none;strokeColor=none;" vertex="1" parent="1">
          <mxGeometry x="460" y="245" width="260" height="15" as="geometry" />
        </mxCell>
        <mxCell id="route-auth" value="/api/auth/*" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#bbb;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="465" y="265" width="80" height="28" as="geometry" />
        </mxCell>
        <mxCell id="route-chat" value="/api/chat/*" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#bbb;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="550" y="265" width="80" height="28" as="geometry" />
        </mxCell>
        <mxCell id="route-prod" value="/api/products/*" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#bbb;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="635" y="265" width="80" height="28" as="geometry" />
        </mxCell>
        <mxCell id="route-user" value="/api/users/*" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#bbb;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="465" y="298" width="80" height="28" as="geometry" />
        </mxCell>
        <mxCell id="route-order" value="/api/orders/*" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#bbb;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="550" y="298" width="80" height="28" as="geometry" />
        </mxCell>
        <mxCell id="route-analytics" value="/api/analytics/*" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#bbb;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="635" y="298" width="80" height="28" as="geometry" />
        </mxCell>

        <mxCell id="api-ctrl" value="&lt;b&gt;Controllers&lt;/b&gt;&lt;br&gt;chatController | authController&lt;br&gt;productController | orderController" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#999;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="460" y="340" width="260" height="50" as="geometry" />
        </mxCell>

        <mxCell id="api-ws" value="&lt;b&gt;WebSocket Server&lt;/b&gt;&lt;br&gt;Path: /ws | Heartbeat: 30s&lt;br&gt;Max Payload: 64KB&lt;br&gt;Typing indicators &amp; live messages" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="460" y="405" width="260" height="60" as="geometry" />
        </mxCell>

        <mxCell id="api-svc" value="&lt;b&gt;Service Layer&lt;/b&gt;&lt;br&gt;aiService (→ AI Service HTTP)&lt;br&gt;Input/Output Validation Proxy" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#999;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="460" y="480" width="260" height="50" as="geometry" />
        </mxCell>

        <mxCell id="api-security" value="Security: Helmet | bcryptjs | JWT | Rate Limit (100 req/min)" style="text;html=1;fontSize=9;align=center;fillColor=none;strokeColor=none;fontColor=#666;" vertex="1" parent="1">
          <mxGeometry x="460" y="540" width="260" height="20" as="geometry" />
        </mxCell>

        <!-- ===== AI SERVICE TIER ===== -->
        <mxCell id="ai-group" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fce4ec;strokeColor=#c0392b;strokeWidth=2;dashed=1;arcSize=8;" vertex="1" parent="1">
          <mxGeometry x="820" y="80" width="380" height="720" as="geometry" />
        </mxCell>
        <mxCell id="ai-label" value="AI SERVICE TIER" style="text;html=1;fontSize=13;fontStyle=1;align=center;fillColor=none;strokeColor=none;fontColor=#c0392b;" vertex="1" parent="1">
          <mxGeometry x="940" y="85" width="140" height="20" as="geometry" />
        </mxCell>

        <mxCell id="ai-service" value="&lt;b&gt;AI Service (Django 5.1)&lt;/b&gt;&lt;br&gt;Django REST Framework&lt;br&gt;Gunicorn (4 workers) | Port 3067" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11;verticalAlign=middle;arcSize=12;" vertex="1" parent="1">
          <mxGeometry x="850" y="115" width="320" height="55" as="geometry" />
        </mxCell>

        <!-- Orchestrator -->
        <mxCell id="orchestrator" value="&lt;b&gt;Agent Orchestrator&lt;/b&gt;&lt;br&gt;Multi-Agent Pipeline Manager" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e6b8af;strokeColor=#b85450;fontSize=11;fontStyle=0;" vertex="1" parent="1">
          <mxGeometry x="870" y="185" width="280" height="40" as="geometry" />
        </mxCell>

        <!-- Pipeline Steps -->
        <mxCell id="step1" value="&lt;b&gt;1. Input Validation Agent&lt;/b&gt;&lt;br&gt;Prompt Injection (LLM)&lt;br&gt;Toxicity (Detoxify, 70%)&lt;br&gt;Topic Relevance (LLM)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff;strokeColor=#ea9999;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="870" y="240" width="135" height="65" as="geometry" />
        </mxCell>
        <mxCell id="step2" value="&lt;b&gt;2. Sentiment Analysis&lt;/b&gt;&lt;br&gt;Sentiment Classification&lt;br&gt;Frustration Level&lt;br&gt;Auto-Escalation" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff;strokeColor=#ea9999;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="1015" y="240" width="135" height="65" as="geometry" />
        </mxCell>

        <mxCell id="step3" value="&lt;b&gt;3. Intent Detection Agent&lt;/b&gt;&lt;br&gt;7 Intent Categories (LLM)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff;strokeColor=#ea9999;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="870" y="320" width="280" height="35" as="geometry" />
        </mxCell>

        <!-- Specialized Agents -->
        <mxCell id="agents-label" value="&lt;b&gt;4. Specialized Agents&lt;/b&gt;" style="text;html=1;fontSize=10;fontStyle=0;align=center;fillColor=none;strokeColor=none;" vertex="1" parent="1">
          <mxGeometry x="870" y="365" width="280" height="15" as="geometry" />
        </mxCell>
        <mxCell id="agent-cs" value="Customer&lt;br&gt;Support" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe0b2;strokeColor=#e65100;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="870" y="385" width="65" height="40" as="geometry" />
        </mxCell>
        <mxCell id="agent-ot" value="Order&lt;br&gt;Tracking" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe0b2;strokeColor=#e65100;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="940" y="385" width="65" height="40" as="geometry" />
        </mxCell>
        <mxCell id="agent-ps" value="Product&lt;br&gt;Search" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe0b2;strokeColor=#e65100;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="1010" y="385" width="65" height="40" as="geometry" />
        </mxCell>
        <mxCell id="agent-pi" value="Payment&lt;br&gt;Info" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe0b2;strokeColor=#e65100;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="1080" y="385" width="65" height="40" as="geometry" />
        </mxCell>
        <mxCell id="agent-rec" value="Recom-&lt;br&gt;mendation" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe0b2;strokeColor=#e65100;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="870" y="430" width="65" height="40" as="geometry" />
        </mxCell>
        <mxCell id="agent-sa" value="Sentiment&lt;br&gt;Analysis" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe0b2;strokeColor=#e65100;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="940" y="430" width="65" height="40" as="geometry" />
        </mxCell>
        <mxCell id="agent-an" value="Analytics&lt;br&gt;Agent" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe0b2;strokeColor=#e65100;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="1010" y="430" width="65" height="40" as="geometry" />
        </mxCell>
        <mxCell id="agent-gen" value="General&lt;br&gt;(LLM)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe0b2;strokeColor=#e65100;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="1080" y="430" width="65" height="40" as="geometry" />
        </mxCell>

        <!-- Tools -->
        <mxCell id="tools-box" value="&lt;b&gt;5. E-Commerce Toolkit&lt;/b&gt;&lt;br&gt;lookup_customer_info | track_order&lt;br&gt;search_products | get_payment_info&lt;br&gt;get_recommendations | get_analytics" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8eaf6;strokeColor=#5c6bc0;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="870" y="485" width="280" height="55" as="geometry" />
        </mxCell>

        <!-- Output Validation -->
        <mxCell id="step6" value="&lt;b&gt;6. Output Validation Agent&lt;/b&gt;&lt;br&gt;Toxicity Check (Detoxify, 0.7) | Bias Detection | PII Masking (spaCy NER)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff;strokeColor=#ea9999;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="870" y="555" width="280" height="45" as="geometry" />
        </mxCell>

        <!-- Validators -->
        <mxCell id="validators" value="&lt;b&gt;Validators App&lt;/b&gt;&lt;br&gt;InputValidator | OutputValidator&lt;br&gt;Detoxify | spaCy en_core_web_sm" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f3e5f5;strokeColor=#7b1fa2;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="870" y="615" width="280" height="45" as="geometry" />
        </mxCell>

        <!-- Data App -->
        <mxCell id="data-app" value="&lt;b&gt;Data App&lt;/b&gt;&lt;br&gt;Seed Data: 12 Customers, 25 Products, 18 Orders, 18 Payments, 7 Coupons, 24 Reviews" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8f5e9;strokeColor=#388e3c;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="870" y="675" width="280" height="40" as="geometry" />
        </mxCell>

        <mxCell id="ai-openai" value="OpenAI API (gpt-4o-mini)" style="text;html=1;fontSize=9;align=center;fillColor=none;strokeColor=none;fontColor=#666;" vertex="1" parent="1">
          <mxGeometry x="870" y="725" width="280" height="20" as="geometry" />
        </mxCell>

        <!-- ===== PROTOCOL SERVERS ===== -->
        <mxCell id="proto-group" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ede7f6;strokeColor=#7e57c2;strokeWidth=2;dashed=1;arcSize=8;" vertex="1" parent="1">
          <mxGeometry x="1260" y="80" width="300" height="380" as="geometry" />
        </mxCell>
        <mxCell id="proto-label" value="PROTOCOL SERVERS" style="text;html=1;fontSize=13;fontStyle=1;align=center;fillColor=none;strokeColor=none;fontColor=#7e57c2;" vertex="1" parent="1">
          <mxGeometry x="1320" y="85" width="180" height="20" as="geometry" />
        </mxCell>

        <mxCell id="mcp-server" value="&lt;b&gt;MCP Server&lt;/b&gt;&lt;br&gt;Model Context Protocol&lt;br&gt;Node.js 20 | Port 3068" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d1c4e9;strokeColor=#7e57c2;fontSize=11;verticalAlign=middle;arcSize=12;" vertex="1" parent="1">
          <mxGeometry x="1280" y="115" width="260" height="55" as="geometry" />
        </mxCell>
        <mxCell id="mcp-tools" value="&lt;b&gt;8 MCP Tools&lt;/b&gt;&lt;br&gt;customer_lookup | order_lookup&lt;br&gt;product_search | payment_status&lt;br&gt;recommendation_engine&lt;br&gt;inventory_check | coupon_validation&lt;br&gt;analytics_summary" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff;strokeColor=#9575cd;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="1280" y="180" width="260" height="85" as="geometry" />
        </mxCell>
        <mxCell id="mcp-feat" value="Tool Registry | Zod Validation&lt;br&gt;30s Timeout | Metrics Tracking&lt;br&gt;3-min Result Cache (Redis)" style="text;html=1;fontSize=9;align=center;fillColor=none;strokeColor=none;fontColor=#666;" vertex="1" parent="1">
          <mxGeometry x="1280" y="270" width="260" height="35" as="geometry" />
        </mxCell>

        <mxCell id="a2a-server" value="&lt;b&gt;A2A Server&lt;/b&gt;&lt;br&gt;Agent-to-Agent Protocol&lt;br&gt;Node.js 20 | Port 3069" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d1c4e9;strokeColor=#7e57c2;fontSize=11;verticalAlign=middle;arcSize=12;" vertex="1" parent="1">
          <mxGeometry x="1280" y="315" width="260" height="55" as="geometry" />
        </mxCell>
        <mxCell id="a2a-agents" value="&lt;b&gt;6 A2A Agents&lt;/b&gt;&lt;br&gt;customerSupport | product | order&lt;br&gt;payment | recommendation | sentiment" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff;strokeColor=#9575cd;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="1280" y="380" width="260" height="55" as="geometry" />
        </mxCell>

        <!-- ===== DATA TIER ===== -->
        <mxCell id="data-group" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff3e0;strokeColor=#ef6c00;strokeWidth=2;dashed=1;arcSize=8;" vertex="1" parent="1">
          <mxGeometry x="420" y="660" width="340" height="300" as="geometry" />
        </mxCell>
        <mxCell id="data-label" value="DATA TIER" style="text;html=1;fontSize=13;fontStyle=1;align=center;fillColor=none;strokeColor=none;fontColor=#ef6c00;" vertex="1" parent="1">
          <mxGeometry x="540" y="665" width="100" height="20" as="geometry" />
        </mxCell>

        <mxCell id="postgres" value="&lt;b&gt;PostgreSQL 16&lt;/b&gt;&lt;br&gt;Port 5499 (internal)" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=10;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="445" y="695" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="pg-tables" value="&lt;b&gt;13 Tables&lt;/b&gt;&lt;br&gt;users | products | orders&lt;br&gt;payments | conversations&lt;br&gt;messages | reviews | coupons&lt;br&gt;wishlist | cart_items&lt;br&gt;notifications | analytics_events&lt;br&gt;agent_executions" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff;strokeColor=#d6b656;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="435" y="770" width="155" height="100" as="geometry" />
        </mxCell>
        <mxCell id="pg-feat" value="UUID PKs | JSONB | Full-text Search&lt;br&gt;GIN Indexes | CASCADE FKs" style="text;html=1;fontSize=8;align=center;fillColor=none;strokeColor=none;fontColor=#666;" vertex="1" parent="1">
          <mxGeometry x="435" y="875" width="155" height="25" as="geometry" />
        </mxCell>

        <mxCell id="redis" value="&lt;b&gt;Redis 7&lt;/b&gt;&lt;br&gt;Port 6399 (internal)" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=10;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="610" y="695" width="130" height="60" as="geometry" />
        </mxCell>
        <mxCell id="redis-dbs" value="&lt;b&gt;4 Databases&lt;/b&gt;&lt;br&gt;DB 0: API (sessions, cache)&lt;br&gt;DB 1: AI Service&lt;br&gt;DB 2: MCP Server&lt;br&gt;DB 3: A2A Server" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff;strokeColor=#b85450;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="600" y="770" width="145" height="70" as="geometry" />
        </mxCell>
        <mxCell id="redis-feat" value="User Cache (5m TTL)&lt;br&gt;Token Blacklist | Refresh Tokens&lt;br&gt;MCP Tool Cache (3m)" style="text;html=1;fontSize=8;align=center;fillColor=none;strokeColor=none;fontColor=#666;" vertex="1" parent="1">
          <mxGeometry x="600" y="845" width="145" height="30" as="geometry" />
        </mxCell>

        <!-- ===== EXTERNAL SERVICES ===== -->
        <mxCell id="ext-group" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f3f3f3;strokeColor=#999;strokeWidth=2;dashed=1;arcSize=8;" vertex="1" parent="1">
          <mxGeometry x="1260" y="520" width="300" height="200" as="geometry" />
        </mxCell>
        <mxCell id="ext-label" value="EXTERNAL SERVICES" style="text;html=1;fontSize=13;fontStyle=1;align=center;fillColor=none;strokeColor=none;fontColor=#666;" vertex="1" parent="1">
          <mxGeometry x="1330" y="525" width="160" height="20" as="geometry" />
        </mxCell>
        <mxCell id="openai" value="&lt;b&gt;OpenAI API&lt;/b&gt;&lt;br&gt;gpt-4o-mini&lt;br&gt;Chat Completions" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8eaf6;strokeColor=#3949ab;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="1280" y="555" width="120" height="55" as="geometry" />
        </mxCell>
        <mxCell id="hf" value="&lt;b&gt;HuggingFace&lt;/b&gt;&lt;br&gt;bert-base-uncased&lt;br&gt;(Detoxify)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff3e0;strokeColor=#ef6c00;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="1420" y="555" width="120" height="55" as="geometry" />
        </mxCell>
        <mxCell id="spacy" value="&lt;b&gt;spaCy&lt;/b&gt;&lt;br&gt;en_core_web_sm&lt;br&gt;PII / NER" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8f5e9;strokeColor=#388e3c;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="1280" y="625" width="120" height="55" as="geometry" />
        </mxCell>
        <mxCell id="detoxify" value="&lt;b&gt;Detoxify&lt;/b&gt;&lt;br&gt;Toxicity Detection&lt;br&gt;BERT-based" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fce4ec;strokeColor=#c62828;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="1420" y="625" width="120" height="55" as="geometry" />
        </mxCell>

        <!-- ===== SECURITY BOX ===== -->
        <mxCell id="sec-group" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffebee;strokeColor=#c62828;strokeWidth=2;dashed=1;arcSize=8;" vertex="1" parent="1">
          <mxGeometry x="40" y="440" width="320" height="200" as="geometry" />
        </mxCell>
        <mxCell id="sec-label" value="SECURITY FEATURES" style="text;html=1;fontSize=13;fontStyle=1;align=center;fillColor=none;strokeColor=none;fontColor=#c62828;" vertex="1" parent="1">
          <mxGeometry x="100" y="445" width="200" height="20" as="geometry" />
        </mxCell>
        <mxCell id="sec-input" value="&lt;b&gt;Input Security&lt;/b&gt;&lt;br&gt;- Prompt Injection Detection&lt;br&gt;- Toxicity Filtering (70%)&lt;br&gt;- Topic Validation&lt;br&gt;- Rate Limiting (100 req/min)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff;strokeColor=#ef9a9a;fontSize=9;align=left;spacingLeft=5;" vertex="1" parent="1">
          <mxGeometry x="55" y="475" width="145" height="80" as="geometry" />
        </mxCell>
        <mxCell id="sec-output" value="&lt;b&gt;Output Security&lt;/b&gt;&lt;br&gt;- Toxicity Check (0.7)&lt;br&gt;- Bias Detection&lt;br&gt;- PII Masking (NER)&lt;br&gt;- Payment Data Protection" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff;strokeColor=#ef9a9a;fontSize=9;align=left;spacingLeft=5;" vertex="1" parent="1">
          <mxGeometry x="205" y="475" width="145" height="80" as="geometry" />
        </mxCell>
        <mxCell id="sec-auth" value="Auth: bcryptjs | JWT (24h access, 7d refresh) | Token Blacklist | Helmet Headers" style="text;html=1;fontSize=8;align=center;fillColor=none;strokeColor=none;fontColor=#666;" vertex="1" parent="1">
          <mxGeometry x="55" y="565" width="295" height="20" as="geometry" />
        </mxCell>

        <!-- ===== DOCKER BOX ===== -->
        <mxCell id="docker-group" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e3f2fd;strokeColor=#1565c0;strokeWidth=2;dashed=1;arcSize=8;" vertex="1" parent="1">
          <mxGeometry x="40" y="680" width="320" height="130" as="geometry" />
        </mxCell>
        <mxCell id="docker-label" value="DOCKER INFRASTRUCTURE" style="text;html=1;fontSize=13;fontStyle=1;align=center;fillColor=none;strokeColor=none;fontColor=#1565c0;" vertex="1" parent="1">
          <mxGeometry x="70" y="685" width="260" height="20" as="geometry" />
        </mxCell>
        <mxCell id="docker-info" value="&lt;b&gt;Docker Compose&lt;/b&gt;&lt;br&gt;7 Services | Bridge Network (ecommerce_net)&lt;br&gt;Health Checks | Volume Persistence&lt;br&gt;Internal ports: PostgreSQL 5499, Redis 6399&lt;br&gt;External ports: 3065-3069" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#bbdefb;strokeColor=#1565c0;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="55" y="715" width="290" height="80" as="geometry" />
        </mxCell>

        <!-- ===== CONNECTIONS ===== -->
        <!-- Client to API -->
        <mxCell id="conn1" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#2e75b6;strokeWidth=2;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" source="rest-client" target="api-service" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="conn1-label" value="REST / HTTPS" style="edgeLabel;html=1;align=center;verticalAlign=middle;fontSize=9;fontColor=#2e75b6;" vertex="1" connectable="0" parent="conn1">
          <mxGeometry x="-0.1" relative="1" as="geometry"><mxPoint as="offset" /></mxGeometry>
        </mxCell>

        <mxCell id="conn2" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#d6b656;strokeWidth=2;dashed=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" source="ws-client" target="api-ws" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="conn2-label" value="WebSocket" style="edgeLabel;html=1;align=center;verticalAlign=middle;fontSize=9;fontColor=#d6b656;" vertex="1" connectable="0" parent="conn2">
          <mxGeometry x="-0.1" relative="1" as="geometry"><mxPoint as="offset" /></mxGeometry>
        </mxCell>

        <!-- API to AI Service -->
        <mxCell id="conn3" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#c0392b;strokeWidth=2;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" source="api-svc" target="ai-service" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="790" y="505" />
              <mxPoint x="790" y="143" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="conn3-label" value="HTTP (internal)" style="edgeLabel;html=1;align=center;verticalAlign=middle;fontSize=9;fontColor=#c0392b;" vertex="1" connectable="0" parent="conn3">
          <mxGeometry x="-0.3" relative="1" as="geometry"><mxPoint as="offset" /></mxGeometry>
        </mxCell>

        <!-- AI Service to MCP -->
        <mxCell id="conn4" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#7e57c2;strokeWidth=2;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" source="tools-box" target="mcp-server" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1230" y="513" />
              <mxPoint x="1230" y="343" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="conn4-label" value="MCP Protocol" style="edgeLabel;html=1;align=center;verticalAlign=middle;fontSize=9;fontColor=#7e57c2;" vertex="1" connectable="0" parent="conn4">
          <mxGeometry x="-0.2" relative="1" as="geometry"><mxPoint as="offset" /></mxGeometry>
        </mxCell>

        <!-- API to PostgreSQL -->
        <mxCell id="conn5" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#ef6c00;strokeWidth=2;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" source="api-group" target="postgres" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- API to Redis -->
        <mxCell id="conn6" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#b85450;strokeWidth=2;exitX=0.75;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" source="api-group" target="redis" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- AI Service to OpenAI -->
        <mxCell id="conn7" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#3949ab;strokeWidth=2;dashed=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" source="ai-service" target="openai" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1230" y="143" />
              <mxPoint x="1230" y="583" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="conn7-label" value="OpenAI API" style="edgeLabel;html=1;align=center;verticalAlign=middle;fontSize=9;fontColor=#3949ab;" vertex="1" connectable="0" parent="conn7">
          <mxGeometry x="0.5" relative="1" as="geometry"><mxPoint as="offset" /></mxGeometry>
        </mxCell>

        <!-- Pipeline flow arrows -->
        <mxCell id="flow1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;strokeColor=#c0392b;strokeWidth=1;endArrow=block;endFill=1;" edge="1" source="step1" target="step3" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="flow2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;strokeColor=#c0392b;strokeWidth=1;endArrow=block;endFill=1;" edge="1" source="step2" target="step3" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>